# runtimeï¼ˆè¿è¡Œæ—¶ï¼‰

## ğŸ”¥Latest News

- [2025/12] runtimeé¡¹ç›®é¦–æ¬¡ä¸Šçº¿ã€‚

## æ¦‚è¿°

æœ¬ä»“æä¾›CANNè¿è¡Œæ—¶ç»„ä»¶å’Œç»´æµ‹åŠŸèƒ½ç»„ä»¶ã€‚
- Runtimeç»„ä»¶ï¼šæä¾›Ascend NPUè¿è¡Œæ—¶ç”¨æˆ·ç¼–ç¨‹æ¥å£å’Œè¿è¡Œæ—¶æ ¸å¿ƒå®ç°ï¼ŒåŒ…æ‹¬è®¾å¤‡ç®¡ç†ã€æµç®¡ç†ã€Eventç®¡ç†ã€å†…å­˜ç®¡ç†ã€ä»»åŠ¡è°ƒåº¦ç­‰åŠŸèƒ½ã€‚ 
- ç»´æµ‹åŠŸèƒ½ç»„ä»¶ï¼šåŒ…æ‹¬æ€§èƒ½æ•°æ®é‡‡é›†ã€æ¨¡å‹å’Œç®—å­Dumpã€æ—¥å¿—ã€é”™è¯¯æ—¥å¿—è®°å½•ç­‰åŠŸèƒ½ã€‚
    - æ€§èƒ½è°ƒä¼˜ï¼ˆmsprofï¼‰æ¨¡å—ï¼šè¿›è¡Œæ€§èƒ½è°ƒä¼˜æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ€§èƒ½è°ƒä¼˜å·¥å…·æ¥é‡‡é›†å’Œåˆ†æè¿è¡Œåœ¨æ˜‡è…¾AIå¤„ç†å™¨SoCNPU IPåŠ é€Ÿå™¨ä¸Šçš„AIä»»åŠ¡å„ä¸ªè¿è¡Œé˜¶æ®µçš„å…³é”®æ€§èƒ½æŒ‡æ ‡ï¼Œç”¨äºå¯æ ¹æ®è¾“å‡ºçš„æ€§èƒ½æ•°æ®ï¼Œå¿«é€Ÿå®šä½è½¯ã€ç¡¬ä»¶æ€§èƒ½ç“¶é¢ˆï¼Œæå‡AIä»»åŠ¡æ€§èƒ½åˆ†æçš„æ•ˆç‡ã€‚
    - ç²¾åº¦è°ƒè¯•ï¼ˆadumpï¼‰æ¨¡å—ï¼šæä¾›Ascend NPUè¿è¡Œæ—¶ç”¨æˆ·Dumpå•ç®—å­æˆ–æ¨¡å‹ï¼ˆæ¯ä¸€å±‚ç®—å­ï¼‰çš„è¾“å…¥/è¾“å‡ºæ•°æ®ï¼Œç”¨äºä¸æŒ‡å®šç®—å­æˆ–æ¨¡å‹è¿›è¡Œå¯¹æ¯”ï¼Œå®šä½ç²¾åº¦é—®é¢˜ï¼›æä¾›Ascend NPUè¿è¡Œå¼‚å¸¸æ—¶Dumpå¼‚å¸¸ç®—å­çš„è¾“å…¥/è¾“å‡ºæ•°æ®ã€Workspaceä¿¡æ¯ï¼ŒTilingä¿¡æ¯ï¼Œç”¨äºåˆ†æAI Core Erroré—®é¢˜ã€‚
    - æ—¥å¿—ï¼ˆlogï¼‰æ¨¡å—ï¼šæ—¥å¿—æä¾›è®°å½•è¿›ç¨‹æ‰§è¡Œè¿‡ç¨‹ä¿¡æ¯çš„èƒ½åŠ›ï¼Œåœ¨å…¶ä»–è¿›ç¨‹è¿è¡Œæ—¶ï¼Œæ—¥å¿—çš„æ¥å£æä¾›è¿›ç¨‹æ‰“å°å’Œè½ç›˜æ—¥å¿—çš„åŠŸèƒ½ï¼Œæ–¹ä¾¿ç³»ç»Ÿæ•…éšœçš„è¯Šæ–­åˆ†æï¼Œå¿«é€Ÿå®ç°é—®é¢˜å®šä½ã€‚è¯¥æ¨¡å—ä¸‹çš„msnpureportä¸ºå‘½ä»¤è¡Œå·¥å…·ï¼Œæ”¯æŒå¯¼å‡ºdeviceä¾§æ—¥å¿—å’ŒæŸ¥è¯¢è®¾ç½®deviceä¾§çŠ¶æ€ç­‰åŠŸèƒ½ã€‚


## ç›®å½•ç»“æ„

å…³é”®ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š

  ```
  â”œâ”€â”€ cmake                                          # å·¥ç¨‹ç¼–è¯‘ç›®å½•
  â”œâ”€â”€ docs                                           # æ–‡æ¡£ä»‹ç»
  â”œâ”€â”€ example                                        # åŸºäºaclæ¥å£å¼€å‘çš„æ ·ä¾‹ä»£ç 
  â”œâ”€â”€ include                                        # 3.1åŒ…æ•´ä½“å¯¹å¤–å‘å¸ƒçš„å¤´æ–‡ä»¶
  |   â”œâ”€â”€ dfx                                        # dfxç›¸å…³å¤´æ–‡ä»¶  
  |   â”œâ”€â”€ driver                                     # é©±åŠ¨ç›¸å…³å¤´æ–‡ä»¶
  |   â”œâ”€â”€ external                                   # æœ¬ä»“å¯¹å¤–æä¾›çš„å¤´æ–‡ä»¶
  |   ......
  â”œâ”€â”€ pkg_inc                                        # ä»“é—´ç®¡æ§ç›¸å…³å¤´æ–‡ä»¶ 
  â”œâ”€â”€ scripts                                        # è¾…åŠ©æ„å»ºç›¸å…³æ–‡ä»¶
  â”œâ”€â”€ src                                            # æ‰€æœ‰3.1åŒ…å†…å„æ¨¡å—çš„æºä»£ç 
  |   â”œâ”€â”€ acl                                        # aclå¯¹å¤–apiå­˜æ”¾ç›®å½•  
  |   â”œâ”€â”€ dfx                                        # dfxæ¨¡å—ç›®å½•
  |   |   â”œâ”€â”€ adump                                  # adumpæ¨¡å—ç›®å½•
  |   |   â”œâ”€â”€ log                                    # logæ¨¡å—ç›®å½•
  |   |   â”œâ”€â”€ msprof                                 # msprofæ¨¡å—ç›®å½•
  |   |   â”œâ”€â”€ trace                                  # traceæ¨¡å—ç›®å½•
  |   |   ......                                     
  |   â”œâ”€â”€ mmpa                                       # mmpaæ¨¡å—ç›®å½•
  |   â”œâ”€â”€ runtime                                    # runtimeæ¨¡å—ç›®å½•
  |   ......
  â”œâ”€â”€ stub                                           # æ‰“æ¡©ç›¸å…³ç›®å½•
  â”œâ”€â”€ tests                                          # UTç”¨ä¾‹
  â”œâ”€â”€ third_party                                    # ä¾èµ–åŒ…ç›¸å…³æ–‡ä»¶
  ......
  â”œâ”€â”€ CMakeLists.txt                                 # æ„å»ºç¼–è¯‘é…ç½®æ–‡ä»¶
  â”œâ”€â”€ build.sh                                       # é¡¹ç›®å·¥ç¨‹ç¼–è¯‘è„šæœ¬
  ```


## æºç ç¼–è¯‘&éƒ¨ç½²

### Runtimeä»“æ•´åŒ…æºç ç¼–è¯‘

#### å‰ææ¡ä»¶

ä½¿ç”¨æœ¬é¡¹ç›®å‰ï¼Œè¯·ç¡®ä¿å¦‚ä¸‹åŸºç¡€ä¾èµ–ã€NPUé©±åŠ¨å’Œå›ºä»¶å·²å®‰è£…ã€‚

1. **å®‰è£…ä¾èµ–**

    æœ¬é¡¹ç›®æºç ç¼–è¯‘ç”¨åˆ°çš„ä¾èµ–å¦‚ä¸‹ï¼Œè¯·æ³¨æ„ç‰ˆæœ¬è¦æ±‚ã€‚

    - python >= 3.7.0
    - gcc >= 7.3.0, <= 13
    - cmake >= 3.16.0
    - ccache
    - autoconf
    - gperf
    - libtool
    - asan ï¼ˆä»…æ‰§è¡ŒUTæ—¶ä¾èµ–ï¼Œè¯·ç¡®ä¿å·²å®‰è£…ä¸gccç‰ˆæœ¬å¯¹åº”çš„asanç‰ˆæœ¬ï¼Œä¾‹å¦‚gcc 9.5.0éœ€è¦å®‰è£…libasan6ç‰ˆæœ¬ï¼‰
    - googletestï¼ˆä»…æ‰§è¡ŒUTæ—¶ä¾èµ–ï¼Œå»ºè®®ç‰ˆæœ¬ release-1.14.0ï¼‰

    ä¸Šè¿°ä¾èµ–åŒ…ï¼ˆasané™¤å¤–ï¼‰å¯é€šè¿‡é¡¹ç›®æ ¹ç›®å½•ä¸‹install_deps.shå®‰è£…ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼Œè‹¥é‡åˆ°ä¸æ”¯æŒç³»ç»Ÿï¼Œè¯·å‚è€ƒè¯¥æ–‡ä»¶è‡ªè¡Œé€‚é…ï¼š
    ```bash
    bash install_deps.sh
    ```

2. **å®‰è£…é©±åŠ¨ä¸å›ºä»¶ï¼ˆè¿è¡Œæ€ä¾èµ–ï¼‰**

    è¿è¡ŒRuntimeæ—¶å¿…é¡»å®‰è£…é©±åŠ¨ä¸å›ºä»¶ï¼Œå®‰è£…æŒ‡å¯¼è¯¦è§ã€Š[CANN è½¯ä»¶å®‰è£…æŒ‡å—](https://www.hiascend.com/document/detail/zh/canncommercial/83RC1/softwareinst/instg/instg_0005.html?Mode=PmIns&InstallType=local&OS=openEuler&Software=cannToolKit)ã€‹ã€‚

#### ç¯å¢ƒå‡†å¤‡

1. **å®‰è£…CANN toolkitåŒ…**

    å•å‡»[ä¸‹è½½é“¾æ¥](https://ascend.devcloud.huaweicloud.com/cann/run/software/8.5.0-beta.1)ï¼Œæ ¹æ®å®é™…ç¯å¢ƒæ¶æ„ï¼Œè·å–å¯¹åº”çš„`Ascend-cann-toolkit_${cann_version}_linux-${arch}.run`åŒ…ã€‚

    ```bash
    # ç¡®ä¿å®‰è£…åŒ…å…·æœ‰å¯æ‰§è¡Œæƒé™
    chmod +x Ascend-cann-toolkit_${cann_version}_linux-${arch}.run
    # å®‰è£…å‘½ä»¤
    ./Ascend-cann-toolkit_${cann_version}_linux-${arch}.run --full --force --quiet --install-path=${install_path}
    ```
    - \$\{cann\_version\}ï¼šè¡¨ç¤ºCANNåŒ…ç‰ˆæœ¬å·ã€‚
    - \$\{arch\}ï¼šè¡¨ç¤ºCPUæ¶æ„ï¼Œå¦‚aarch64ã€x86_64ã€‚
    - \$\{install\_path\}ï¼šè¡¨ç¤ºæŒ‡å®šå®‰è£…è·¯å¾„ï¼Œå¯é€‰ï¼Œrootç”¨æˆ·é»˜è®¤å®‰è£…åœ¨`/usr/local/Ascend`ç›®å½•ï¼Œæ™®é€šç”¨æˆ·é»˜è®¤å®‰è£…åœ¨å½“å‰ç›®å½•ã€‚

2. **é…ç½®ç¯å¢ƒå˜é‡**
	
	æ ¹æ®å®é™…åœºæ™¯ï¼Œé€‰æ‹©åˆé€‚çš„å‘½ä»¤ã€‚

    ```bash
    # é»˜è®¤è·¯å¾„å®‰è£…ï¼Œä»¥rootç”¨æˆ·ä¸ºä¾‹ï¼ˆérootç”¨æˆ·ï¼Œå°†/usr/localæ›¿æ¢ä¸º${HOME}ï¼‰  
    source /usr/local/Ascend/cann/set_env.sh
    # æŒ‡å®šè·¯å¾„å®‰è£…
    # source ${install_path}/cann/set_env.sh
    ```

3. **ä¸‹è½½æºç **

    ```bash
    # ä¸‹è½½é¡¹ç›®æºç ï¼Œä»¥masteråˆ†æ”¯ä¸ºä¾‹
    git clone https://gitcode.com/cann/runtime.git
    ```

#### ç¼–è¯‘å®‰è£…

`Runtime`æä¾›ä¸€é”®å¼ç¼–è¯‘èƒ½åŠ›ï¼Œå¯é€šè¿‡å¦‚ä¸‹å‘½ä»¤è¿›è¡Œç¼–è¯‘ï¼š

```bash
export CMAKE_TLS_VERIFY=0
bash build.sh
```
æ›´å¤šç¼–è¯‘å‚æ•°å¯ä»¥é€šè¿‡`bash build.sh -h`æŸ¥çœ‹ã€‚

ç¼–è¯‘å®Œæˆä¹‹åä¼šåœ¨`build_out`ç›®å½•ä¸‹ç”Ÿäº§`cann-npu-runtime_<version>_linux-<arch>.run`è½¯ä»¶åŒ…ã€‚
\<version>è¡¨ç¤ºç‰ˆæœ¬å·ã€‚
\<arch>è¡¨ç¤ºæ“ä½œç³»ç»Ÿæ¶æ„ï¼Œå–å€¼åŒ…æ‹¬x86_64ä¸aarch64ã€‚
å¯æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å®‰è£…ç¼–è¯‘ç”Ÿæˆçš„Runtimeè½¯ä»¶åŒ…ï¼š

```bash
./cann-npu-runtime_<version>_linux-<arch>.run --full --install-path=${install_path}
```
- \$\{version\}ï¼šè¡¨ç¤ºrunåŒ…ç‰ˆæœ¬å·ã€‚
- \$\{arch\}ï¼šè¡¨ç¤ºCPUæ¶æ„ï¼Œå¦‚aarch64ã€x86_64ã€‚
- \$\{install\_path\}ï¼šè¡¨ç¤ºæŒ‡å®šå®‰è£…è·¯å¾„ï¼Œå¯é€‰ï¼Œé»˜è®¤å®‰è£…åœ¨`/usr/local/Ascend`ç›®å½•ã€‚

å®‰è£…å®Œæˆä¹‹åï¼Œç”¨æˆ·ç¼–è¯‘ç”Ÿæˆçš„Runtimeè½¯ä»¶åŒ…ä¼šæ›¿æ¢å·²å®‰è£…CANNå¼€å‘å¥—ä»¶åŒ…ä¸­çš„Runtimeç›¸å…³è½¯ä»¶ã€‚
                                       

## æœ¬åœ°éªŒè¯ 

ç¼–è¯‘å®Œæˆåï¼Œç”¨æˆ·å¯ä»¥è¿›è¡Œå¼€å‘æµ‹è¯•ï¼ˆDTï¼šDevelopment Testingï¼‰ï¼ŒéªŒè¯é¡¹ç›®åŠŸèƒ½æ˜¯å¦æ­£å¸¸ã€‚
> è¯´æ˜ï¼šæ‰§è¡ŒUTç”¨ä¾‹ä¾èµ–googletestå•å…ƒæµ‹è¯•æ¡†æ¶ï¼Œè¯¦ç»†ä»‹ç»å‚è§[googletestå®˜ç½‘](https://google.github.io/googletest/advanced.html#running-a-subset-of-the-tests)ï¼Œç”Ÿæˆä»£ç è¦†ç›–ç‡æŠ¥å‘Šéœ€è¦ç‹¬ç«‹å®‰è£…lcovè½¯ä»¶ï¼ˆå¦‚æœç”±äºlcovå·¥å…·ç‰ˆæœ¬çš„åŸå› å‡ºç°æŠ¥é”™ï¼Œè¯·æ ¹æ®æç¤ºä¿®æ”¹è„šæœ¬ç›¸å…³å†…å®¹ï¼Œé€‰æ‹©åˆé€‚çš„å‚æ•°è¿›è¡Œé€‚é…ï¼‰ã€‚

ç¼–è¯‘æ‰§è¡Œ`UT`æµ‹è¯•ç”¨ä¾‹ï¼š

```bash
bash tests/build_ut.sh --ut=acl --target=ascendcl_utest -c
```
- `--ut`å¯ä»¥æŒ‡å®šéœ€è¦æ‰§è¡Œçš„`tests/ut`ç›®å½•ä¸‹çš„ç”¨ä¾‹æ–‡ä»¶ï¼Œä¾‹å¦‚`aclã€runtime`ç­‰;
- `--target`å¯ä»¥æŒ‡å®šéœ€è¦æ‰§è¡Œçš„ç”¨ä¾‹æ–‡ä»¶ç¼–è¯‘å‡ºæ¥çš„ç›®æ ‡äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆå¯èƒ½æœ‰å¤šä¸ªï¼‰ï¼Œä¾‹å¦‚aclç”¨ä¾‹å¯ä»¥ä½¿ç”¨`tests/ut/acl/CMakeLists.txt`æ–‡ä»¶ä¸­å®šä¹‰çš„`ascendcl_utest`ï¼›runtimeç”¨ä¾‹å¯ä»¥ä½¿ç”¨`tests/ut/runtime/runtime/CMakeLists.txt`æ–‡ä»¶ä¸­å®šä¹‰çš„`runtime_utest_task_910B`ï¼Œæ‰§è¡Œruntimeå…¨é‡ç”¨ä¾‹åˆ™éœ€è¦æŒ‡å®štargetä¸º`runtime_ut`;
- `-c`å¯ä»¥è·å–è¦†ç›–ç‡ï¼ˆå¦‚æ— éœ€è·å–è¦†ç›–ç‡ï¼Œå¯çœç•¥æ­¤å‚æ•°ï¼‰ã€‚

UTæµ‹è¯•ç”¨ä¾‹ç¼–è¯‘è¾“å‡ºç›®å½•ä¸º`build`ï¼Œå¦‚æœæƒ³æ¸…é™¤å†å²ç¼–è¯‘è®°å½•ï¼Œå¯ä»¥æ‰§è¡Œå¦‚ä¸‹æ“ä½œï¼š

```bash
rm -rf build_ut/ output/ build/
```
æ³¨ï¼š`tests/build_ut.sh`è„šæœ¬æ”¯æŒçš„è¯¦ç»†å‘½ä»¤å‚æ•°å¯ä»¥é€šè¿‡`bash tests/build_ut.sh -h`æŸ¥çœ‹ã€‚

**æ¥ä¸‹æ¥å¯å‚è€ƒ[æ ·ä¾‹è¿è¡Œ](example/README.md)å°è¯•è¿è¡Œæ ·ä¾‹**ã€‚

## ç›¸å…³ä¿¡æ¯
- [è´¡çŒ®æŒ‡å—](CONTRIBUTING.md)
- [å®‰å…¨å£°æ˜](SECURITY.md)
- [è®¸å¯è¯](LICENSE)
